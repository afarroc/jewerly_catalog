{% load static %}
<header class="main-header">
    <!-- Top Bar with Contact Info -->
    <div class="header-top">
        <div class="header-container">
            <div class="header-info">
                <div class="info-item">
                    <i class="fas fa-phone" aria-hidden="true"></i>
                    <a href="tel:+51123456789" class="info-link">+51 123 456 789</a>
                </div>
                <div class="info-item">
                    <i class="fas fa-envelope" aria-hidden="true"></i>
                    <a href="mailto:info@joyeriafantasia.com" class="info-link">info@joyeriafantasia.com</a>
                </div>
                <div class="info-item">
                    <i class="fas fa-clock" aria-hidden="true"></i>
                    <span>Lun - Sab: 9:00 - 18:00</span>
                </div>
            </div>

            <div class="header-actions">
                <button class="language-selector" aria-label="Cambiar idioma" data-bs-toggle="dropdown">
                    <i class="fas fa-globe" aria-hidden="true"></i>
                    <span>ES</span>
                    <i class="fas fa-chevron-down" aria-hidden="true"></i>
                </button>
                <button class="currency-selector" aria-label="Cambiar moneda" data-bs-toggle="dropdown">
                    <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                    <span>PEN</span>
                    <i class="fas fa-chevron-down" aria-hidden="true"></i>
                </button>
                {% if user.is_authenticated %}
                <div class="user-welcome">
                    <i class="fas fa-user-circle" aria-hidden="true"></i>
                    <span>Hola, {{ user.first_name|default:user.username }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Enhanced Responsive Navbar -->
    <nav class="enhanced-navbar" role="navigation" aria-label="Navegación principal">
        <div class="navbar-container">
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle"
                    id="mobile-menu-toggle"
                    aria-label="Abrir menú de navegación"
                    aria-expanded="false"
                    aria-controls="mobile-navigation">
                <span class="hamburger-line" aria-hidden="true"></span>
                <span class="hamburger-line" aria-hidden="true"></span>
                <span class="hamburger-line" aria-hidden="true"></span>
            </button>

            <!-- Brand/Logo Section -->
            <div class="navbar-brand">
                <a href="{% url 'home:index' %}"
                   class="brand-link"
                   aria-label="Joyería Fantasía - Página principal">
                    <div class="brand-logo-wrapper">
                        <img src="{% static 'images/logos/logo.png' %}"
                             alt="Logo Joyería Fantasía"
                             class="navbar-logo"
                             loading="lazy"
                             onerror="this.style.display='none'">
                        <div class="brand-icon-fallback" aria-hidden="true">
                            <i class="fas fa-gem"></i>
                        </div>
                    </div>
                    <div class="brand-text">
                        <span class="brand-title">Joyería Fantasía</span>
                        <span class="brand-subtitle">Joyas Artesanales</span>
                    </div>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <div class="navbar-navigation" id="navbar-navigation">
                <ul class="nav-menu" role="menubar">
                    <li class="nav-item" role="none">
                        <a href="{% url 'home:index' %}"
                           class="nav-link {% if request.resolver_match.url_name == 'index' %}active{% endif %}"
                           role="menuitem"
                           aria-current="{% if request.resolver_match.url_name == 'index' %}page{% endif %}">
                            <i class="fas fa-home" aria-hidden="true"></i>
                            <span class="nav-text">Inicio</span>
                        </a>
                    </li>

                    <li class="nav-item dropdown" role="none">
                        <button class="nav-link dropdown-toggle {% if 'products' in request.resolver_match.app_name %}active{% endif %}"
                                role="menuitem"
                                aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="products-dropdown">
                            <i class="fas fa-gem" aria-hidden="true"></i>
                            <span class="nav-text">Productos</span>
                            <i class="fas fa-chevron-down dropdown-arrow" aria-hidden="true"></i>
                        </button>
                        <div class="dropdown-menu" id="products-dropdown" role="menu" aria-hidden="true">
                            <div class="dropdown-section">
                                <h4 class="dropdown-title">Categorías</h4>
                                <a href="{% url 'products:product_list' %}" class="dropdown-item" role="menuitem">
                                    <i class="fas fa-th-large" aria-hidden="true"></i>
                                    <span>Ver Todos</span>
                                </a>
                                <a href="{% url 'products:product_list' %}?featured=true" class="dropdown-item featured" role="menuitem">
                                    <i class="fas fa-star" aria-hidden="true"></i>
                                    <span>Destacados</span>
                                </a>
                                <a href="{% url 'products:product_list' %}?sort=price_low" class="dropdown-item" role="menuitem">
                                    <i class="fas fa-tags" aria-hidden="true"></i>
                                    <span>Ofertas</span>
                                </a>
                                <a href="{% url 'products:product_list' %}?sort=newest" class="dropdown-item" role="menuitem">
                                    <i class="fas fa-clock" aria-hidden="true"></i>
                                    <span>Novedades</span>
                                </a>
                            </div>
                            <div class="dropdown-section">
                                <h4 class="dropdown-title">Tipo de Joya</h4>
                                <a href="{% url 'products:product_list' %}?type=ring" class="dropdown-item" role="menuitem">
                                    <i class="fas fa-ring" aria-hidden="true"></i>
                                    <span>Anillos</span>
                                </a>
                                <a href="{% url 'products:product_list' %}?type=necklace" class="dropdown-item" role="menuitem">
                                    <i class="fas fa-gem" aria-hidden="true"></i>
                                    <span>Collares</span>
                                </a>
                                <a href="{% url 'products:product_list' %}?type=bracelet" class="dropdown-item" role="menuitem">
                                    <i class="fas fa-link" aria-hidden="true"></i>
                                    <span>Pulseras</span>
                                </a>
                            </div>
                        </div>
                    </li>

                    <li class="nav-item" role="none">
                        <a href="{% url 'home:index' %}#about"
                           class="nav-link"
                           role="menuitem">
                            <i class="fas fa-info-circle" aria-hidden="true"></i>
                            <span class="nav-text">Nosotros</span>
                        </a>
                    </li>

                    <li class="nav-item" role="none">
                        <a href="{% url 'home:index' %}#contact"
                           class="nav-link"
                           role="menuitem">
                            <i class="fas fa-envelope" aria-hidden="true"></i>
                            <span class="nav-text">Contacto</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Enhanced Search Bar -->
            <div class="navbar-search">
                <form class="search-form"
                      action="{% url 'products:product_list' %}"
                      method="GET"
                      role="search"
                      aria-label="Buscar productos">
                    <div class="search-input-wrapper">
                        <input type="text"
                               name="q"
                               class="search-input"
                               placeholder="Buscar joyas, anillos, collares..."
                               aria-label="Buscar productos"
                               autocomplete="off"
                               spellcheck="false">
                        <button type="submit"
                                class="search-btn"
                                aria-label="Buscar">
                            <i class="fas fa-search" aria-hidden="true"></i>
                        </button>
                        <button type="button"
                                class="search-clear"
                                aria-label="Limpiar búsqueda"
                                style="display: none;">
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div class="search-suggestions" id="search-suggestions" aria-live="polite"></div>
                </form>
            </div>

            <!-- Enhanced User Actions -->
            <div class="navbar-actions">
                <!-- Wishlist -->
                {% if user.is_authenticated %}
                <a href="{% url 'accounts:profile' %}#wishlist"
                   class="action-btn wishlist-btn"
                   aria-label="Ver lista de deseos">
                    <i class="fas fa-heart" aria-hidden="true"></i>
                    <span class="action-text">Favoritos</span>
                </a>
                {% endif %}

                <!-- Cart -->
                <a href="{% url 'cart:cart_detail' %}"
                   class="action-btn cart-btn"
                   aria-label="Ver carrito de compras">
                    <div class="cart-wrapper">
                        <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                        <span class="cart-count"
                              id="cart-count"
                              aria-label="Cantidad de productos en carrito">0</span>
                    </div>
                    <span class="action-text">Carrito</span>
                </a>

                <!-- User Menu -->
                {% if user.is_authenticated %}
                <div class="user-menu dropdown">
                    <button class="action-btn user-btn"
                            aria-haspopup="true"
                            aria-expanded="false"
                            aria-controls="user-dropdown">
                        <div class="user-avatar">
                            {% if user.profile_image %}
                                <img src="{{ user.profile_image.url }}" alt="Avatar de {{ user.username }}">
                            {% else %}
                                <i class="fas fa-user" aria-hidden="true"></i>
                            {% endif %}
                        </div>
                        <span class="action-text">{{ user.first_name|default:'Cuenta' }}</span>
                        <i class="fas fa-chevron-down dropdown-arrow" aria-hidden="true"></i>
                    </button>
                    <div class="dropdown-menu user-dropdown"
                         id="user-dropdown"
                         role="menu"
                         aria-hidden="true">
                        <div class="user-info">
                            <div class="user-avatar-large">
                                {% if user.profile_image %}
                                    <img src="{{ user.profile_image.url }}" alt="Avatar de {{ user.username }}">
                                {% else %}
                                    <i class="fas fa-user-circle" aria-hidden="true"></i>
                                {% endif %}
                            </div>
                            <div class="user-details">
                                <span class="user-full-name">{{ user.get_full_name|default:user.username }}</span>
                                <span class="user-email">{{ user.email }}</span>
                            </div>
                        </div>
                        <div class="dropdown-divider" aria-hidden="true"></div>
                        <a href="{% url 'accounts:profile' %}" class="dropdown-item" role="menuitem">
                            <i class="fas fa-user" aria-hidden="true"></i>
                            <span>Mi Perfil</span>
                        </a>
                        <a href="{% url 'orders:order_history' %}" class="dropdown-item" role="menuitem">
                            <i class="fas fa-receipt" aria-hidden="true"></i>
                            <span>Mis Pedidos</span>
                        </a>
                        <a href="{% url 'accounts:profile' %}#wishlist" class="dropdown-item" role="menuitem">
                            <i class="fas fa-heart" aria-hidden="true"></i>
                            <span>Lista de Deseos</span>
                        </a>
                        <a href="{% url 'accounts:profile' %}#addresses" class="dropdown-item" role="menuitem">
                            <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                            <span>Mis Direcciones</span>
                        </a>
                        <div class="dropdown-divider" aria-hidden="true"></div>
                        <a href="{% url 'accounts:logout' %}" class="dropdown-item logout" role="menuitem">
                            <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                            <span>Cerrar Sesión</span>
                        </a>
                    </div>
                </div>
                {% else %}
                <div class="auth-buttons">
                    <a href="{% url 'accounts:login' %}" class="action-btn auth-btn login-btn">
                        <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                        <span class="action-text">Iniciar Sesión</span>
                    </a>
                    <a href="{% url 'accounts:register' %}" class="action-btn auth-btn register-btn primary">
                        <i class="fas fa-user-plus" aria-hidden="true"></i>
                        <span class="action-text">Registrarse</span>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Enhanced Mobile Navigation Overlay -->
        <div class="mobile-nav-overlay"
             id="mobile-nav-overlay"
             aria-hidden="true">
            <div class="mobile-nav-content">
                <!-- Mobile Header -->
                <div class="mobile-nav-header">
                    <div class="mobile-brand">
                        <div class="brand-logo-wrapper">
                            <img src="{% static 'images/logos/logo.png' %}"
                                 alt="Logo Joyería Fantasía"
                                 class="mobile-logo"
                                 loading="lazy"
                                 onerror="this.style.display='none'">
                            <div class="brand-icon-fallback" aria-hidden="true">
                                <i class="fas fa-gem"></i>
                            </div>
                        </div>
                        <span class="mobile-brand-title">Joyería Fantasía</span>
                    </div>
                    <button class="mobile-nav-close"
                            id="mobile-nav-close"
                            aria-label="Cerrar menú de navegación">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>

                <!-- Mobile Search -->
                <div class="mobile-search">
                    <form class="search-form"
                          action="{% url 'products:product_list' %}"
                          method="GET"
                          role="search">
                        <div class="search-input-wrapper">
                            <input type="text"
                                   name="q"
                                   class="search-input"
                                   placeholder="Buscar joyas..."
                                   aria-label="Buscar productos"
                                   autocomplete="off"
                                   spellcheck="false">
                            <button type="submit"
                                    class="search-btn"
                                    aria-label="Buscar">
                                <i class="fas fa-search" aria-hidden="true"></i>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Mobile Navigation Menu -->
                <nav class="mobile-nav-menu" aria-label="Menú de navegación móvil">
                    <ul class="mobile-nav-list">
                        <li class="mobile-nav-item">
                            <a href="{% url 'home:index' %}"
                               class="mobile-nav-link {% if request.resolver_match.url_name == 'index' %}active{% endif %}">
                                <i class="fas fa-home" aria-hidden="true"></i>
                                <span>Inicio</span>
                            </a>
                        </li>

                        <li class="mobile-nav-item">
                            <a href="{% url 'products:product_list' %}"
                               class="mobile-nav-link {% if 'products' in request.resolver_match.app_name %}active{% endif %}">
                                <i class="fas fa-gem" aria-hidden="true"></i>
                                <span>Productos</span>
                            </a>
                        </li>

                        {% if user.is_authenticated %}
                        <li class="mobile-nav-item">
                            <a href="{% url 'accounts:profile' %}" class="mobile-nav-link">
                                <i class="fas fa-user" aria-hidden="true"></i>
                                <span>Mi Perfil</span>
                            </a>
                        </li>

                        <li class="mobile-nav-item">
                            <a href="{% url 'orders:order_history' %}" class="mobile-nav-link">
                                <i class="fas fa-receipt" aria-hidden="true"></i>
                                <span>Mis Pedidos</span>
                            </a>
                        </li>

                        <li class="mobile-nav-item">
                            <a href="{% url 'accounts:profile' %}#wishlist" class="mobile-nav-link">
                                <i class="fas fa-heart" aria-hidden="true"></i>
                                <span>Favoritos</span>
                            </a>
                        </li>
                        {% endif %}

                        <li class="mobile-nav-item">
                            <a href="{% url 'cart:cart_detail' %}" class="mobile-nav-link">
                                <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                                <span>Carrito</span>
                                <span class="cart-count" id="mobile-cart-count">0</span>
                            </a>
                        </li>

                        {% if not user.is_authenticated %}
                        <li class="mobile-nav-item">
                            <a href="{% url 'accounts:login' %}" class="mobile-nav-link">
                                <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                                <span>Iniciar Sesión</span>
                            </a>
                        </li>

                        <li class="mobile-nav-item">
                            <a href="{% url 'accounts:register' %}" class="mobile-nav-link primary">
                                <i class="fas fa-user-plus" aria-hidden="true"></i>
                                <span>Registrarse</span>
                            </a>
                        </li>
                        {% else %}
                        <li class="mobile-nav-item">
                            <a href="{% url 'accounts:logout' %}" class="mobile-nav-link logout">
                                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                                <span>Cerrar Sesión</span>
                            </a>
                        </li>
                        {% endif %}

                        <li class="mobile-nav-item">
                            <a href="{% url 'home:index' %}#about" class="mobile-nav-link">
                                <i class="fas fa-info-circle" aria-hidden="true"></i>
                                <span>Nosotros</span>
                            </a>
                        </li>

                        <li class="mobile-nav-item">
                            <a href="{% url 'home:index' %}#contact" class="mobile-nav-link">
                                <i class="fas fa-envelope" aria-hidden="true"></i>
                                <span>Contacto</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Mobile Footer -->
                <div class="mobile-nav-footer">
                    <div class="mobile-contact">
                        <div class="contact-item">
                            <i class="fas fa-phone" aria-hidden="true"></i>
                            <a href="tel:+51123456789" class="info-link">+51 123 456 789</a>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope" aria-hidden="true"></i>
                            <a href="mailto:info@joyeriafantasia.com" class="info-link">info@joyeriafantasia.com</a>
                        </div>
                    </div>
                    <div class="mobile-social">
                        <a href="#" class="social-link" aria-label="Facebook">
                            <i class="fab fa-facebook-f" aria-hidden="true"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Instagram">
                            <i class="fab fa-instagram" aria-hidden="true"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Twitter">
                            <i class="fab fa-twitter" aria-hidden="true"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="WhatsApp">
                            <i class="fab fa-whatsapp" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Minimal Announcement Bar -->
    <div class="announcement-bar minimal" id="announcement-bar" role="banner" aria-label="Promotional announcements">
        <div class="announcement-container">
            <div class="announcement-content">
                <i class="fas fa-truck announcement-icon" aria-hidden="true"></i>
                <span class="announcement-text">
                    🚚 Envío gratis en compras mayores a S/. 150
                </span>
                <a href="{% url 'products:product_list' %}" class="announcement-link" aria-label="Ver productos con envío gratis">
                    Ver productos
                </a>
            </div>
            <button class="announcement-close" id="announcement-close" aria-label="Cerrar anuncio">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
    </div>
</header>